<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>已标记题目</title>
    <style>
        /* 基础样式重置 */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            max-width: 850px; margin: 0 auto; padding: 20px;
            background-color: #f8f9fa; color: #333; line-height: 1.6;
        }

        .container {
            background-color: white; padding: 30px; border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        h1 {
            text-align: center; color: #2c3e50; margin-bottom: 30px;
            font-weight: 600; font-size: 1.8rem;
        }

        .back-link {
            display: inline-block; margin-bottom: 20px; color: #4a69bd;
            text-decoration: none; font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .question-card {
            border: 1px solid #e1e8f0; padding: 25px; border-radius: 10px;
            margin-bottom: 20px; background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.04);
            transition: all 0.3s ease;
        }

        .question-card:hover {
            box-shadow: 0 6px 15px rgba(0,0,0,0.07);
        }

        .question-title-container {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 15px;
        }

        .question-title {
            font-weight: 600; font-size: 1.1rem; color: #2c3e50;
        }

        .bookmark-btn {
            background: none; border: none; cursor: pointer; color: #f39c12;
            padding: 5px;
        }

        .no-bookmarks {
            text-align: center; padding: 40px 0; color: #7f8c8d;
        }

        .pagination {
            display: flex; justify-content: center; margin-top: 30px;
        }

        .btn {
            background-color: #4a69bd; color: white; border: none;
            padding: 10px 20px; text-align: center; text-decoration: none;
            display: inline-block; font-size: 14px; margin: 6px 3px; cursor: pointer;
            border-radius: 6px; transition: all 0.3s ease; font-weight: 500;
        }

        .btn:hover {
            background-color: #3c57a1; transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(74, 105, 189, 0.2);
        }

        /* 优化移动端显示 */
        @media (max-width: 600px) {
            body { padding: 15px; }
            .container { padding: 20px; }
            h1 { font-size: 1.5rem; }
            .question-card { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">← 返回题库</a>
        <h1>已标记题目</h1>
        <div style="margin-bottom: 20px;">
            <label for="bookmark-filter-type">按题型过滤:</label>
            <select id="bookmark-filter-type">
                <option value="all">所有题型</option>
                <option value="single_choice">单选题</option>
                <option value="multiple_choice">多选题</option>
                <option value="true_false">判断题</option>
            </select>
        </div>
        <!-- <div id="debug-info" style="font-size: 12px; color: #666; margin-bottom: 20px;">调试信息加载中...</div> -->
        <div id="bookmarks-container"></div>
    </div>

    <script src="questions.js"></script>
    <script>
        // 存储题库数据
        let questionData = window.questionData || {
            single_choice: [],
            multiple_choice: [],
            true_false: []
        };

        // 存储已标记题目的ID集合
        let bookmarkedQuestions = new Set();
        // 当前选择的过滤类型
        let currentFilterType = 'all';

        // Cookie管理函数
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        function getCookie(name) {
            const cookieName = name + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const cookieArray = decodedCookie.split(';');
            for (let i = 0; i < cookieArray.length; i++) {
                let cookie = cookieArray[i];
                while (cookie.charAt(0) === ' ') {
                    cookie = cookie.substring(1);
                }
                if (cookie.indexOf(cookieName) === 0) {
                    return cookie.substring(cookieName.length, cookie.length);
                }
            }
            return "";
        }

        // 初始化已标记题目
        function initBookmarks() {
            const bookmarkedIds = getCookie('bookmarkedQuestions');
            if (bookmarkedIds) {
                bookmarkedIds.split(',').forEach(id => {
                    id = id.trim(); // 去除可能的空格
                    if (id) bookmarkedQuestions.add(id);
                });
            }
        }

        // 切换题目标记状态
        function toggleBookmark(questionId, element) {
            if (bookmarkedQuestions.has(questionId)) {
                bookmarkedQuestions.delete(questionId);
                element.classList.remove('active');
            } else {
                bookmarkedQuestions.add(questionId);
                element.classList.add('active');
            }

            // 更新Cookie
            if (bookmarkedQuestions.size > 0) {
                setCookie('bookmarkedQuestions', Array.from(bookmarkedQuestions).join(','), 30);
            } else {
                // 当没有标记题目时，删除Cookie
                document.cookie = 'bookmarkedQuestions=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            }

            // 重新渲染标记题目列表
            renderBookmarkedQuestions();
        }

        // 更新调试信息
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            const cookieValue = getCookie('bookmarkedQuestions');
            const totalQuestions = questionData.single_choice.length + questionData.multiple_choice.length + questionData.true_false.length;
            const debugText = `
                总题目数: ${totalQuestions}
                Cookie中的标记ID: ${cookieValue || '无'}
                已标记题目数: ${bookmarkedQuestions.size}
            `;
            debugInfo.textContent = debugText.trim().replace(/\s+/g, ' ');
        }

        // 渲染已标记题目
        function renderBookmarkedQuestions() {
            const container = document.getElementById('bookmarks-container');
            container.innerHTML = '';

            // 更新调试信息
            // updateDebugInfo();

            if (bookmarkedQuestions.size === 0) {
                container.innerHTML = '<div class="no-bookmarks">暂无已标记题目</div>';
                return;
            }

            // 获取所有题目并过滤出已标记的
            const allQuestions = [
                ...questionData.single_choice.map(q => ({...q, type: 'single_choice'})),
                ...questionData.multiple_choice.map(q => ({...q, type: 'multiple_choice'})),
                ...questionData.true_false.map(q => ({...q, type: 'true_false'}))
            ];

            // 先筛选出已标记的题目
            const allBookmarkedQuestions = allQuestions.filter(q => {
                const fullQuestionId = `${q.type}_${q.id}`;
                return bookmarkedQuestions.has(fullQuestionId);
            });

            // 再根据当前选择的类型进行过滤
            let bookmarkedQuestionsList;
            if (currentFilterType === 'all') {
                bookmarkedQuestionsList = allBookmarkedQuestions;
            } else {
                bookmarkedQuestionsList = allBookmarkedQuestions.filter(q => q.type === currentFilterType);
            }

            bookmarkedQuestionsList.forEach((question, index) => {
                const card = document.createElement('div');
                card.className = 'question-card';

                // 创建题目标题和标记按钮
                const titleContainer = document.createElement('div');
                titleContainer.className = 'question-title-container';

                const title = document.createElement('div');
                title.className = 'question-title';
                title.textContent = `${index + 1}. ${question.question}`;

                const bookmarkBtn = document.createElement('button');
                bookmarkBtn.className = 'bookmark-btn active';
                bookmarkBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path></svg>';
                // 传入包含题型的完整ID
                const fullQuestionId = `${question.type}_${question.id}`;
                bookmarkBtn.addEventListener('click', () => toggleBookmark(fullQuestionId, bookmarkBtn));

                titleContainer.appendChild(title);
                titleContainer.appendChild(bookmarkBtn);
                card.appendChild(titleContainer);

                // 添加题目类型标签
            const typeTag = document.createElement('div');
            typeTag.style.fontSize = '0.8rem';
            typeTag.style.color = '#7f8c8d';
            typeTag.style.marginBottom = '10px';
            if (question.type === 'single_choice') {
                typeTag.textContent = '单选题';
            } else if (question.type === 'multiple_choice') {
                typeTag.textContent = '多选题';
            } else if (question.type === 'true_false') {
                typeTag.textContent = '判断题';
            }
            card.appendChild(typeTag);

            // 添加题目选项
            const optionsContainer = document.createElement('div');
            optionsContainer.style.marginBottom = '15px';
            optionsContainer.style.padding = '10px';
            optionsContainer.style.backgroundColor = '#f5f7fa';
            optionsContainer.style.borderRadius = '6px';

            if (question.options && question.options.length > 0) {
                question.options.forEach((option, index) => {
                    const optionItem = document.createElement('div');
                    optionItem.style.marginBottom = '5px';
                    optionItem.style.display = 'flex';
                    optionItem.style.alignItems = 'center';

                    // 选项字母标识 (A, B, C, D...)
                    const optionLabel = document.createElement('span');
                    optionLabel.style.fontWeight = 'bold';
                    optionLabel.style.marginRight = '10px';
                    optionLabel.textContent = String.fromCharCode(65 + index) + '.';

                    // 选项内容
                    const optionText = document.createElement('span');
                    optionText.textContent = option;

                    // 判断是否为正确答案
                    if (question.type === 'true_false') {
                        // 判断题特殊处理
                        const isCorrect = (index === 0 && question.answer === 'true') || (index === 1 && question.answer === 'false');
                        if (isCorrect) {
                            optionItem.style.color = '#2e7d32';
                        }
                    } else {
                        // 单选题和多选题
                        const correctAnswers = Array.isArray(question.answer) ? question.answer : [question.answer];
                        if (correctAnswers.includes(String.fromCharCode(65 + index))) {
                            optionItem.style.color = '#2e7d32';
                        }
                    }

                    optionItem.appendChild(optionLabel);
                    optionItem.appendChild(optionText);
                    optionsContainer.appendChild(optionItem);
                });
            } else {
                const noOptionsText = document.createElement('div');
                noOptionsText.textContent = '无选项数据';
                optionsContainer.appendChild(noOptionsText);
            }

            card.appendChild(optionsContainer);

            // 添加答案和解析
            const answerSection = document.createElement('div');
            answerSection.style.marginTop = '15px';
            answerSection.style.paddingTop = '15px';
            answerSection.style.borderTop = '1px dashed #e1e8f0';

            const answerLabel = document.createElement('div');
            answerLabel.style.fontWeight = '600';
            answerLabel.style.marginBottom = '5px';
            answerLabel.textContent = '答案:';

            const answerValue = document.createElement('div');
            answerValue.style.marginBottom = '10px';
            // 格式化显示答案
            if (question.type === 'true_false') {
                answerValue.textContent = question.answer === 'true' ? '正确' : '错误';
            } else {
                answerValue.textContent = question.answer;
            }

            const explanationLabel = document.createElement('div');
            explanationLabel.style.fontWeight = '600';
            explanationLabel.style.marginBottom = '5px';
            explanationLabel.textContent = '解析:';

            const explanationValue = document.createElement('div');
            explanationValue.textContent = question.explanation || '暂无解析';

            answerSection.appendChild(answerLabel);
            answerSection.appendChild(answerValue);
            answerSection.appendChild(explanationLabel);
            answerSection.appendChild(explanationValue);

            card.appendChild(answerSection);

            container.appendChild(card);
            });
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 确保questions.js已加载并提供数据
            if (!window.questionData || Object.keys(window.questionData).length === 0) {
                console.error('题库数据加载失败');
                document.getElementById('bookmarks-container').innerHTML = '<div class="no-bookmarks">题库数据加载失败，请刷新页面重试</div>';
                document.getElementById('debug-info').textContent = '题库数据加载失败';
                return;
            }

            // 存储题库数据
            questionData = window.questionData;

            // 初始化过滤选择框事件
            const filterSelect = document.getElementById('bookmark-filter-type');
            filterSelect.addEventListener('change', (e) => {
                currentFilterType = e.target.value;
                renderBookmarkedQuestions();
            });

            initBookmarks();
            renderBookmarkedQuestions();
        });
    </script>
</body>
</html>
